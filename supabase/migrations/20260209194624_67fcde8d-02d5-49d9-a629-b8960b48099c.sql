
-- Create tenants table
CREATE TABLE public.tenants (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  slug TEXT NOT NULL UNIQUE,
  custom_domain TEXT UNIQUE,
  logo_url TEXT,
  is_active BOOLEAN NOT NULL DEFAULT true,
  settings JSONB DEFAULT '{}',
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
ALTER TABLE public.tenants ENABLE ROW LEVEL SECURITY;

INSERT INTO public.tenants (id, name, slug) VALUES ('00000000-0000-0000-0000-000000000001', 'Default Company', 'default');

CREATE TRIGGER update_tenants_updated_at BEFORE UPDATE ON public.tenants FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();

-- Add tenant_id to ALL tables
ALTER TABLE public.employees ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
CREATE INDEX idx_employees_tenant ON public.employees(tenant_id);

ALTER TABLE public.projects ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
CREATE INDEX idx_projects_tenant ON public.projects(tenant_id);

ALTER TABLE public.tasks ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.workstations ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.orders ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.accessories ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.broken_parts ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.notifications ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.chat_rooms ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.chat_messages ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.holidays ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.holiday_requests ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.gantt_schedules ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.schedules ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.standard_tasks ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.products ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.suppliers ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.stock_locations ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.time_registrations ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.trucks ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.working_hours ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.working_hours_breaks ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.work_hours ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.placement_teams ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.placement_team_members ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.daily_team_assignments ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.rush_orders ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.rush_order_tasks ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.rush_order_assignments ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.rush_order_messages ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.rush_order_task_links ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.parts ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.parts_lists ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.order_items ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.order_attachments ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.order_steps ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.phases ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.phase_offsets ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.production_routes ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.production_route_tasks ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.production_flow_lines ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.pdf_annotations ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.personal_items ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.personal_item_attachments ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.personal_item_shares ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.project_calculation_variables ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.project_costing ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.project_loading_overrides ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.project_messages ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.project_message_reads ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.project_models ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.project_onedrive_configs ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.project_production_completion ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.project_team_assignments ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.project_team_assignment_overrides ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.project_truck_assignments ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.project_sync_logs ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.recurring_task_schedules ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.standard_task_checklists ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.standard_task_limit_phases ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.standard_task_workstation_links ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.task_completion_checklists ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.task_workstation_links ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.employee_standard_task_links ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.employee_workstation_links ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.external_api_configs ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.email_configurations ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.email_schedule_configs ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.csv_import_configs ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.orders_sync_logs ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.workstation_errors ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.workstation_positions ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.workstation_schedules ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.workstation_tasks ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.user_preferences ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.storage_system ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.role_permissions ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.product_groups ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.product_group_items ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.calculation_task_relationships ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.cabinet_projects ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.cabinet_configurations ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.cabinet_models ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.cabinet_compartments ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.cabinet_fronts ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.cabinet_materials ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.cabinet_parts ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.cabinet_price_rules ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.cabinet_project_revisions ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.cabinet_quotes ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.compartment_items ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.front_hardware ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.legrabox_configurations ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.help_categories ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.help_articles ADD COLUMN tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001' NOT NULL;
ALTER TABLE public.user_roles ADD COLUMN IF NOT EXISTS tenant_id UUID REFERENCES public.tenants(id) DEFAULT '00000000-0000-0000-0000-000000000001';
